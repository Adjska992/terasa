#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u231058
IdentityFile ~/.ssh/devcloud-access-key-231058.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-231058.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u231058
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-231058.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-231058.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u231058
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-231058.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u231058
IdentityFile ~/.ssh/devcloud-access-key-231058.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-231058.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-231058.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
8evQGyvPxaQgt/AAAAB3UyMzEwNTgBAgM=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-231058.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
