#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u230835
IdentityFile ~/.ssh/devcloud-access-key-230835.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-230835.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u230835
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-230835.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-230835.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u230835
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-230835.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u230835
IdentityFile ~/.ssh/devcloud-access-key-230835.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-230835.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-230835.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
94uzyf+djQpqcAAAAHdTIzMDgzNQECAwQ=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-230835.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
