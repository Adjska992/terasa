#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u230890
IdentityFile ~/.ssh/devcloud-access-key-230890.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-230890.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u230890
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-230890.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-230890.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u230890
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-230890.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u230890
IdentityFile ~/.ssh/devcloud-access-key-230890.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-230890.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-230890.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
hhXzOCgFS6KM8AAAAHdTIzMDg5MAECAwQ=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-230890.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
