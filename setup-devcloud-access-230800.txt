#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u230800
IdentityFile ~/.ssh/devcloud-access-key-230800.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-230800.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u230800
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-230800.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-230800.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u230800
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-230800.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u230800
IdentityFile ~/.ssh/devcloud-access-key-230800.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-230800.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-230800.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
64OLyeTnknbhyVAAAAB3UyMzA4MDABAgM=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-230800.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
