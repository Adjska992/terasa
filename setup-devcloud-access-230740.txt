#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u230740
IdentityFile ~/.ssh/devcloud-access-key-230740.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-230740.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u230740
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-230740.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-230740.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u230740
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-230740.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u230740
IdentityFile ~/.ssh/devcloud-access-key-230740.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-230740.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-230740.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
jRQ7j3KEEzh98AAAAHdTIzMDc0MAECAwQ=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-230740.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
